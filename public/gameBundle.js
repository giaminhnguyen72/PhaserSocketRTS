(()=>{"use strict";class t{constructor(t={keyboard:!1,mouse:!1}){this.tag="EVENTHANDLER",this.components=[],this.events=[],this.eventConfig=t,window.addEventListener("click",(t=>{this.events.push("click")})),window.addEventListener("keydown",(t=>{console.log(t.key),console.log(t.key),console.log(t.key),console.log(t.key),console.log(t.key),console.log(t.key),console.log(t.key),console.log(t.key),console.log(t.key)}))}update(t){for(var e of(console.log("Event Handler"),this.components)){console.log("Has Component");var s=e.eventMap;for(var n of this.events)if(s){var i=s.get(n);i&&(i(),console.log("Has Ran"))}e.update(t)}this.events=[]}}class e{constructor(t){this.tag="GRAPHICS",this.graphicsConfig=t,this.components=[],document.documentElement.style.height="100%",document.documentElement.style.width="100%",document.body.style.height="100%",document.body.style.width="100%",document.body.style.margin="0",this.setup(),this.canvas=this.generateCanvas(),this.ctx=this.canvas.getContext("2d"),this.div=this.generateDiv(this.graphicsConfig.parent),this.entities=[]}update(t){for(var e of(console.log("Graphics"),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.components))console.log(e.componentId),e.update(t,this.ctx),console.log("Inside Graphics Component"),console.log(e.componentId)}generateDiv(t){var e=document.createElement("div");return e.id=t,e.style.position="absolute",e.style.height="100%",e.style.width="100%",e.style.zIndex="1",e.style.backgroundImage="/images/test.jpg",e.appendChild(this.canvas),document.body.appendChild(e),console.log("test"),e}generateCanvas(){var t=document.createElement("CANVAS");return t.id=this.graphicsConfig.canvasID,console.log(this.parseStyle(this.graphicsConfig.style)),console.log("Before"),t.setAttribute("style",this.parseStyle(this.graphicsConfig.style)),t}getCtx(){return this.getCanvas().getContext("2d")}getCanvas(){var t=document.getElementById(this.graphicsConfig.canvasID);if(t instanceof HTMLCanvasElement)return t;throw Error("engineCanvas should be a reserved id for DOM Components")}parseStyle(t){var e=Object.entries(t).map((([t,e])=>t+":"+e+";"));return console.log(this.graphicsConfig.parent),e.join(" ")}setup(){var t=new Image;t.src="/images/test.jpg",t.style.position="absolute",t.style.zIndex="-1",t.style.width="100%",t.style.height="100%",document.body.appendChild(t)}}class s{constructor(){this.tag="PHYSICS",this.components=[]}update(t){for(var e of this.components)e.update(t)}}class n{constructor(t="engineDiv",e="engineCanvas",s={},n){this.parent=t,this.canvasID=e,this.style=s,this.background=n}}class i{}class o{constructor(t,e=[],s){this.name=t,this.entities=e,this.background=s}}class r{constructor(t,e){for(var s of(this.name=t.name,this.entities=new Map,this.engineComponents=new Map,e))this.engineComponents.set(s.tag,[]);for(var n of t.entities)this.addEntity(n);console.log(this.engineComponents),this.background=t.background,this.time=0}addEntity(t){var e=a.getUniqueId();for(var s of(t.id=e,t.scene=this,this.entities.set(e,t),t.components)){var n=this.engineComponents.get(s.engineTag);if(!n){for(var i of(console.log(s.engineTag),this.engineComponents.keys()))console.log(i);throw Error("something wrong adding entities")}n.push(this.createComponent(s))}}removeEntity(t){var e=this.getEntity(t);if(e)for(var s of e.components){var n=this.engineComponents.get(s.engineTag);if(n)for(var i=0;i<n.length;i++)n[i].entity==e&&n.splice(i,1)}return e}getEntity(t){return this.entities.get(t)}createComponent(t){return t.componentId=a.getUniqueComponentId(),t}}class a{constructor(t=[new o("Default")],e,s=0){this.sceneConfigs=t,this.scenes=[];for(var n=0;n<t.length;n++){var i=t[n];console.log("In Scene Manager"),console.log(e),this.scenes.push(new r(i,e))}this.sceneConfigs=t,this.currentIdx=s}switchScenes(t){return this.currentIdx=t,this.getCurrentScene()}getCurrentScene(){return this.scenes[this.currentIdx]}getCurrentEntities(){return this.scenes[this.currentIdx].entities}addCurrentEntity(t){}static getUniqueId(){return a.id++}static getUniqueComponentId(){return a.componentId++}}a.id=0,a.componentId=0;class h{constructor(n=new i,o){if(this.canvasID="engineCanvas",this.systems=[],this.time=0,this.engineConfig=n,this.engineConfig.eventConfig&&this.systems.push(new t(this.engineConfig.eventConfig)),this.engineConfig.physicsConfig&&this.systems.push(new s),o)for(var r of o)this.systems.push(r);for(var r of(this.engineConfig.graphicsConfig&&(this.graphics=new e(this.engineConfig.graphicsConfig),this.systems.push(this.graphics)),this.sceneManager=new a(this.engineConfig.sceneConfig,this.systems),this.running=!0,this.systems)){var h=this.sceneManager.getCurrentScene().engineComponents.get(r.tag);if(!h)throw Error("error in start method");r.components=h}this.running=!1}start(t){if(this.running=!0,this.graphics)this.update(t),window.requestAnimationFrame((()=>this.start(t)));else for(;this.running;)this.update(t)}update(t){for(var e of this.systems)e.update(t);this.time+=t,console.log(this.time)}}class c{constructor(t,e={x:0,y:0,z:0},s={x:0,y:0,z:0},n={x:0,y:0,z:0}){this.engineTag="PHYSICS",this.entity=t,this.pos=e,this.vel=s,this.accel=n}update(t){this.vel.x=this.vel.x+this.accel.x*t,this.vel.y=this.vel.y+this.accel.y*t,this.vel.z=this.vel.z+this.accel.z*t,this.pos.x=this.pos.x+this.vel.x*t,this.pos.y=this.pos.y+this.vel.y*t,this.pos.z=this.pos.z+this.vel.z*t}}class g{constructor(t,e){this.engineTag="GRAPHICS",this.entity=t,this.transform=e}update(t,e){if(e){var s=255*Math.random(),n=255*Math.random(),i=255*Math.random();e.fillStyle=`rgb(\n                ${s},\n                ${n},\n                ${i})`,e.fillRect(this.transform.pos.x,this.transform.pos.y,20,20)}}}class l{constructor(t,e){this.engineTag="EVENTHANDLER",this.entity=t,this.eventMap=new Map,Object.entries(e).map((([t,e])=>{this.eventMap.set(t,e)}))}update(t,e){console.log("In mouse Listener")}}class d{constructor(){this.transform=new c(this,{x:20,y:20,z:20},{x:1,y:1,z:0}),this.renderer=new g(this,this.transform),this.listener=new l(this,{click:()=>{this.transform.pos.x=0,this.transform.pos.y=0},test2:()=>{console.log("test2")}}),this.components=[this.transform,this.renderer,this.listener]}}window.onload=()=>{new h({physicsConfig:{},graphicsConfig:new n("test","193as",{"background-color":"white",width:"100%",height:"100%"}),sceneConfig:[{name:"as",entities:[new d]}],eventConfig:{keyboard:!0,mouse:!0}}).start(1)}})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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U0FBVSxDQUNOLElBQUlpRyxLQUloQnZJLFlBQWEsQ0FDVEMsVUFBVSxFQUNWQyxPQUFPLEtBR1JpSCxNQUFNLEVBQUUsQyIsInNvdXJjZXMiOlsid2VicGFjazovL2VuZ2luZS8uL2Rpc3QvZW5naW5lL3NyYy9ldmVudHMvRXZlbnRIYW5kbGVyLmpzIiwid2VicGFjazovL2VuZ2luZS8uL2Rpc3QvZW5naW5lL3NyYy9ncmFwaGljcy9HcmFwaGljRW5naW5lLmpzIiwid2VicGFjazovL2VuZ2luZS8uL2Rpc3QvZW5naW5lL3NyYy9jb25zdGFudHMvY29tcG9uZW50VHlwZS5qcyIsIndlYnBhY2s6Ly9lbmdpbmUvLi9kaXN0L2VuZ2luZS9zcmMvcGh5c2ljcy9QaHlzaWNzRW5naW5lLmpzIiwid2VicGFjazovL2VuZ2luZS8uL2Rpc3QvZW5naW5lL3NyYy90eXBlcy9jb25maWcuanMiLCJ3ZWJwYWNrOi8vZW5naW5lLy4vZGlzdC9lbmdpbmUvc3JjL3R5cGVzL3NjZW5lLmpzIiwid2VicGFjazovL2VuZ2luZS8uL2Rpc3QvZW5naW5lL3NyYy9jb3JlL21hbmFnZXJzL1NjZW5lTWFuYWdlci5qcyIsIndlYnBhY2s6Ly9lbmdpbmUvLi9kaXN0L2VuZ2luZS9zcmMvY29yZS9lbmdpbmUuanMiLCJ3ZWJwYWNrOi8vZW5naW5lLy4vZGlzdC9lbmdpbmUvc3JjL2NvbXBvbmVudHMvUGh5c2ljcy90cmFuc2Zvcm0uanMiLCJ3ZWJwYWNrOi8vZW5naW5lLy4vZGlzdC9lbmdpbmUvc3JjL2NvbXBvbmVudHMvR3JhcGhpY3MvUmVjdGFuZ2xlLmpzIiwid2VicGFjazovL2VuZ2luZS8uL2Rpc3QvZW5naW5lL3NyYy9jb21wb25lbnRzL0V2ZW50L0xpc3RlbmVyLmpzIiwid2VicGFjazovL2VuZ2luZS8uL2Rpc3QvR2FtZUZyb250ZW5kL3NjZW5lcy9lbnRpdGllcy9QbGF5ZXIuanMiLCJ3ZWJwYWNrOi8vZW5naW5lLy4vZGlzdC9HYW1lRnJvbnRlbmQvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNsYXNzIEV2ZW50SGFuZGxlciB7XHJcbiAgICBjb25zdHJ1Y3RvcihldmVudENvbmZpZyA9IHtcclxuICAgICAgICBrZXlib2FyZDogZmFsc2UsXHJcbiAgICAgICAgbW91c2U6IGZhbHNlXHJcbiAgICB9KSB7XHJcbiAgICAgICAgdGhpcy50YWcgPSBcIkVWRU5USEFORExFUlwiO1xyXG4gICAgICAgIHRoaXMuY29tcG9uZW50cyA9IFtdO1xyXG4gICAgICAgIHRoaXMuZXZlbnRzID0gW107XHJcbiAgICAgICAgdGhpcy5ldmVudENvbmZpZyA9IGV2ZW50Q29uZmlnO1xyXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZXZlbnRzLnB1c2goXCJjbGlja1wiKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGV2ZW50LmtleSk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGV2ZW50LmtleSk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGV2ZW50LmtleSk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGV2ZW50LmtleSk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGV2ZW50LmtleSk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGV2ZW50LmtleSk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGV2ZW50LmtleSk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGV2ZW50LmtleSk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGV2ZW50LmtleSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICB1cGRhdGUoZHQpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIkV2ZW50IEhhbmRsZXJcIik7XHJcbiAgICAgICAgZm9yICh2YXIgY29tcCBvZiB0aGlzLmNvbXBvbmVudHMpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJIYXMgQ29tcG9uZW50XCIpO1xyXG4gICAgICAgICAgICB2YXIgbGlzdGVuYWJsZSA9IGNvbXA7XHJcbiAgICAgICAgICAgIHZhciBldmVudE1hcCA9IGxpc3RlbmFibGUuZXZlbnRNYXA7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGUgb2YgdGhpcy5ldmVudHMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChldmVudE1hcCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBmdW5jID0gZXZlbnRNYXAuZ2V0KGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmdW5jKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmMoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJIYXMgUmFuXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb21wLnVwZGF0ZShkdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZXZlbnRzID0gW107XHJcbiAgICB9XHJcbn1cclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9RXZlbnRIYW5kbGVyLmpzLm1hcCIsImltcG9ydCB7IEdSQVBISUNTX1RBRyB9IGZyb20gXCIuLi9jb25zdGFudHMvY29tcG9uZW50VHlwZS5qc1wiO1xyXG5leHBvcnQgY2xhc3MgR3JhcGhpY3NFbmdpbmUge1xyXG4gICAgY29uc3RydWN0b3IoZ3JhcGhpY3NDb25maWcpIHtcclxuICAgICAgICB0aGlzLnRhZyA9IEdSQVBISUNTX1RBRztcclxuICAgICAgICB0aGlzLmdyYXBoaWNzQ29uZmlnID0gZ3JhcGhpY3NDb25maWc7XHJcbiAgICAgICAgdGhpcy5jb21wb25lbnRzID0gW107XHJcbiAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLmhlaWdodCA9ICcxMDAlJztcclxuICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUud2lkdGggPSAnMTAwJSc7XHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5oZWlnaHQgPSBcIjEwMCVcIjtcclxuICAgICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5tYXJnaW4gPSBcIjBcIjtcclxuICAgICAgICB0aGlzLnNldHVwKCk7XHJcbiAgICAgICAgdGhpcy5jYW52YXMgPSB0aGlzLmdlbmVyYXRlQ2FudmFzKCk7XHJcbiAgICAgICAgdGhpcy5jdHggPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XHJcbiAgICAgICAgdGhpcy5kaXYgPSB0aGlzLmdlbmVyYXRlRGl2KHRoaXMuZ3JhcGhpY3NDb25maWcucGFyZW50KTtcclxuICAgICAgICB0aGlzLmVudGl0aWVzID0gW107XHJcbiAgICB9XHJcbiAgICB1cGRhdGUoZHQpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIkdyYXBoaWNzXCIpO1xyXG4gICAgICAgIHRoaXMuY3R4LmNsZWFyUmVjdCgwLCAwLCB0aGlzLmN0eC5jYW52YXMud2lkdGgsIHRoaXMuY3R4LmNhbnZhcy5oZWlnaHQpO1xyXG4gICAgICAgIGZvciAodmFyIGNvbXAgb2YgdGhpcy5jb21wb25lbnRzKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGNvbXAuY29tcG9uZW50SWQpO1xyXG4gICAgICAgICAgICBjb21wLnVwZGF0ZShkdCwgdGhpcy5jdHgpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkluc2lkZSBHcmFwaGljcyBDb21wb25lbnRcIik7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGNvbXAuY29tcG9uZW50SWQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGdlbmVyYXRlRGl2KHBhcmVudCkge1xyXG4gICAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICBkaXYuaWQgPSBwYXJlbnQ7XHJcbiAgICAgICAgZGl2LnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xyXG4gICAgICAgIGRpdi5zdHlsZS5oZWlnaHQgPSBcIjEwMCVcIjtcclxuICAgICAgICBkaXYuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcclxuICAgICAgICBkaXYuc3R5bGUuekluZGV4ID0gXCIxXCI7XHJcbiAgICAgICAgZGl2LnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IFwiL2ltYWdlcy90ZXN0LmpwZ1wiO1xyXG4gICAgICAgIGRpdi5hcHBlbmRDaGlsZCh0aGlzLmNhbnZhcyk7XHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChkaXYpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwidGVzdFwiKTtcclxuICAgICAgICByZXR1cm4gZGl2O1xyXG4gICAgfVxyXG4gICAgZ2VuZXJhdGVDYW52YXMoKSB7XHJcbiAgICAgICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJDQU5WQVNcIik7XHJcbiAgICAgICAgY2FudmFzLmlkID0gdGhpcy5ncmFwaGljc0NvbmZpZy5jYW52YXNJRDtcclxuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLnBhcnNlU3R5bGUodGhpcy5ncmFwaGljc0NvbmZpZy5zdHlsZSkpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiQmVmb3JlXCIpO1xyXG4gICAgICAgIGNhbnZhcy5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgdGhpcy5wYXJzZVN0eWxlKHRoaXMuZ3JhcGhpY3NDb25maWcuc3R5bGUpKTtcclxuICAgICAgICByZXR1cm4gY2FudmFzO1xyXG4gICAgfVxyXG4gICAgZ2V0Q3R4KCkge1xyXG4gICAgICAgIHZhciBjYW52YXMgPSB0aGlzLmdldENhbnZhcygpO1xyXG4gICAgICAgIHJldHVybiBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xyXG4gICAgfVxyXG4gICAgZ2V0Q2FudmFzKCkge1xyXG4gICAgICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLmdyYXBoaWNzQ29uZmlnLmNhbnZhc0lEKTtcclxuICAgICAgICBpZiAoY2FudmFzIGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNhbnZhcztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKFwiZW5naW5lQ2FudmFzIHNob3VsZCBiZSBhIHJlc2VydmVkIGlkIGZvciBET00gQ29tcG9uZW50c1wiKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBwYXJzZVN0eWxlKHN0eWxlT2JqZWN0KSB7XHJcbiAgICAgICAgdmFyIGNzc0FycmF5ID0gT2JqZWN0LmVudHJpZXMoc3R5bGVPYmplY3QpLm1hcCgoW2ssIHZdKSA9PiBrICsgXCI6XCIgKyB2ICsgXCI7XCIpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuZ3JhcGhpY3NDb25maWcucGFyZW50KTtcclxuICAgICAgICByZXR1cm4gY3NzQXJyYXkuam9pbihcIiBcIik7XHJcbiAgICB9XHJcbiAgICBzZXR1cCgpIHtcclxuICAgICAgICBpZiAodHJ1ZSkge1xyXG4gICAgICAgICAgICB2YXIgaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcclxuICAgICAgICAgICAgaW1hZ2Uuc3JjID0gXCIvaW1hZ2VzL3Rlc3QuanBnXCI7XHJcbiAgICAgICAgICAgIGltYWdlLnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xyXG4gICAgICAgICAgICBpbWFnZS5zdHlsZS56SW5kZXggPSBcIi0xXCI7XHJcbiAgICAgICAgICAgIGltYWdlLnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XHJcbiAgICAgICAgICAgIGltYWdlLnN0eWxlLmhlaWdodCA9IFwiMTAwJVwiO1xyXG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGltYWdlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9R3JhcGhpY0VuZ2luZS5qcy5tYXAiLCJleHBvcnQgY29uc3QgUEhZU0lDU19UQUcgPSBcIlBIWVNJQ1NcIjtcclxuZXhwb3J0IGNvbnN0IEdSQVBISUNTX1RBRyA9IFwiR1JBUEhJQ1NcIjtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y29tcG9uZW50VHlwZS5qcy5tYXAiLCJpbXBvcnQgeyBQSFlTSUNTX1RBRyB9IGZyb20gXCIuLi9jb25zdGFudHMvY29tcG9uZW50VHlwZS5qc1wiO1xyXG5leHBvcnQgY2xhc3MgUGh5c2ljc0VuZ2luZSB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLnRhZyA9IFBIWVNJQ1NfVEFHO1xyXG4gICAgICAgIHRoaXMuY29tcG9uZW50cyA9IFtdO1xyXG4gICAgfVxyXG4gICAgdXBkYXRlKGR0KSB7XHJcbiAgICAgICAgZm9yICh2YXIgY29tcCBvZiB0aGlzLmNvbXBvbmVudHMpIHtcclxuICAgICAgICAgICAgY29tcC51cGRhdGUoZHQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1QaHlzaWNzRW5naW5lLmpzLm1hcCIsIi8qKlxyXG4gKiBEZXNjcmliZXMgdGhlIENTUyBwcm9wZXJ0aWVzIG9mIHRoZSBjYW52YXMgZWxlbWVudFxyXG4gKlxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIFBoeXNpY3NDb25maWcge1xyXG59XHJcbmV4cG9ydCBjbGFzcyBHcmFwaGljc0NvbmZpZyB7XHJcbiAgICBjb25zdHJ1Y3RvcihwYXJlbnQgPSBcImVuZ2luZURpdlwiLCBjYW52YXNJRCA9IFwiZW5naW5lQ2FudmFzXCIsIHN0eWxlID0ge30sIGJhY2tncm91bmQpIHtcclxuICAgICAgICB0aGlzLnBhcmVudCA9IHBhcmVudDtcclxuICAgICAgICB0aGlzLmNhbnZhc0lEID0gY2FudmFzSUQ7XHJcbiAgICAgICAgdGhpcy5zdHlsZSA9IHN0eWxlO1xyXG4gICAgICAgIHRoaXMuYmFja2dyb3VuZCA9IGJhY2tncm91bmQ7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0IGNsYXNzIEVuZ2luZUNvbmZpZyB7XHJcbn1cclxuZXhwb3J0IGNsYXNzIFNjZW5lQ29uZmlnIHtcclxuICAgIGNvbnN0cnVjdG9yKG5hbWUsIGVudGl0aWVzID0gW10sIGJhY2tncm91bmQpIHtcclxuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMuZW50aXRpZXMgPSBlbnRpdGllcztcclxuICAgICAgICB0aGlzLmJhY2tncm91bmQgPSBiYWNrZ3JvdW5kO1xyXG4gICAgfVxyXG59XHJcbmV4cG9ydCBjbGFzcyBFdmVudENvbmZpZyB7XHJcbiAgICBjb25zdHJ1Y3RvcihrZXlib2FyZCwgbW91c2UpIHtcclxuICAgICAgICB0aGlzLmtleWJvYXJkID0ga2V5Ym9hcmQ7XHJcbiAgICAgICAgdGhpcy5tb3VzZSA9IG1vdXNlO1xyXG4gICAgfVxyXG59XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNvbmZpZy5qcy5tYXAiLCJpbXBvcnQgeyBTY2VuZU1hbmFnZXIgfSBmcm9tIFwiLi4vY29yZS9tYW5hZ2Vycy9TY2VuZU1hbmFnZXIuanNcIjtcclxuZXhwb3J0IGNsYXNzIFNjZW5lIHtcclxuICAgIGNvbnN0cnVjdG9yKHNjZW5lQ29uZmlnLCBzeXN0ZW1zKSB7XHJcbiAgICAgICAgdGhpcy5uYW1lID0gc2NlbmVDb25maWcubmFtZTtcclxuICAgICAgICB0aGlzLmVudGl0aWVzID0gbmV3IE1hcCgpO1xyXG4gICAgICAgIHRoaXMuZW5naW5lQ29tcG9uZW50cyA9IG5ldyBNYXAoKTtcclxuICAgICAgICBmb3IgKHZhciBzeXN0ZW0gb2Ygc3lzdGVtcykge1xyXG4gICAgICAgICAgICB0aGlzLmVuZ2luZUNvbXBvbmVudHMuc2V0KHN5c3RlbS50YWcsIFtdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yICh2YXIgZSBvZiBzY2VuZUNvbmZpZy5lbnRpdGllcykge1xyXG4gICAgICAgICAgICB0aGlzLmFkZEVudGl0eShlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5lbmdpbmVDb21wb25lbnRzKTtcclxuICAgICAgICB0aGlzLmJhY2tncm91bmQgPSBzY2VuZUNvbmZpZy5iYWNrZ3JvdW5kO1xyXG4gICAgICAgIHRoaXMudGltZSA9IDA7XHJcbiAgICB9XHJcbiAgICBhZGRFbnRpdHkoZW50aXR5KSB7XHJcbiAgICAgICAgdmFyIHVuaXF1ZUlkID0gU2NlbmVNYW5hZ2VyLmdldFVuaXF1ZUlkKCk7XHJcbiAgICAgICAgZW50aXR5LmlkID0gdW5pcXVlSWQ7XHJcbiAgICAgICAgZW50aXR5LnNjZW5lID0gdGhpcztcclxuICAgICAgICB0aGlzLmVudGl0aWVzLnNldCh1bmlxdWVJZCwgZW50aXR5KTtcclxuICAgICAgICBmb3IgKHZhciBjb21wIG9mIGVudGl0eS5jb21wb25lbnRzKSB7XHJcbiAgICAgICAgICAgIHZhciBjb21wTGlzdCA9IHRoaXMuZW5naW5lQ29tcG9uZW50cy5nZXQoY29tcC5lbmdpbmVUYWcpO1xyXG4gICAgICAgICAgICBpZiAoY29tcExpc3QpIHtcclxuICAgICAgICAgICAgICAgIGNvbXBMaXN0LnB1c2godGhpcy5jcmVhdGVDb21wb25lbnQoY29tcCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coY29tcC5lbmdpbmVUYWcpO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIga2V5IG9mIHRoaXMuZW5naW5lQ29tcG9uZW50cy5rZXlzKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhrZXkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoXCJzb21ldGhpbmcgd3JvbmcgYWRkaW5nIGVudGl0aWVzXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmVtb3ZlRW50aXR5KGlkKSB7XHJcbiAgICAgICAgdmFyIGVudGl0eSA9IHRoaXMuZ2V0RW50aXR5KGlkKTtcclxuICAgICAgICBpZiAoZW50aXR5KSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGUgb2YgZW50aXR5LmNvbXBvbmVudHMpIHtcclxuICAgICAgICAgICAgICAgIHZhciBlbmdpbmVDb21wTGlzdCA9IHRoaXMuZW5naW5lQ29tcG9uZW50cy5nZXQoZS5lbmdpbmVUYWcpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGVuZ2luZUNvbXBMaXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbmdpbmVDb21wTGlzdC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW5naW5lQ29tcExpc3RbaV0uZW50aXR5ID09IGVudGl0eSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5naW5lQ29tcExpc3Quc3BsaWNlKGksIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBlbnRpdHk7XHJcbiAgICB9XHJcbiAgICBnZXRFbnRpdHkoaWQpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5lbnRpdGllcy5nZXQoaWQpO1xyXG4gICAgfVxyXG4gICAgY3JlYXRlQ29tcG9uZW50KGNvbXApIHtcclxuICAgICAgICBjb21wLmNvbXBvbmVudElkID0gU2NlbmVNYW5hZ2VyLmdldFVuaXF1ZUNvbXBvbmVudElkKCk7XHJcbiAgICAgICAgcmV0dXJuIGNvbXA7XHJcbiAgICB9XHJcbn1cclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c2NlbmUuanMubWFwIiwiaW1wb3J0IHsgU2NlbmVDb25maWcgfSBmcm9tIFwiLi4vLi4vdHlwZXMvY29uZmlnLmpzXCI7XHJcbmltcG9ydCB7IFNjZW5lIH0gZnJvbSBcIi4uLy4uL3R5cGVzL3NjZW5lLmpzXCI7XHJcbmV4cG9ydCBjbGFzcyBTY2VuZU1hbmFnZXIge1xyXG4gICAgY29uc3RydWN0b3IoY29uZmlnID0gW25ldyBTY2VuZUNvbmZpZyhcIkRlZmF1bHRcIildLCBzeXN0ZW1zLCBpbmRleCA9IDApIHtcclxuICAgICAgICB0aGlzLnNjZW5lQ29uZmlncyA9IGNvbmZpZztcclxuICAgICAgICB0aGlzLnNjZW5lcyA9IFtdO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY29uZmlnLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBjdXJyQ29uZmlnID0gY29uZmlnW2ldO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkluIFNjZW5lIE1hbmFnZXJcIik7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHN5c3RlbXMpO1xyXG4gICAgICAgICAgICB0aGlzLnNjZW5lcy5wdXNoKG5ldyBTY2VuZShjdXJyQ29uZmlnLCBzeXN0ZW1zKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2NlbmVDb25maWdzID0gY29uZmlnO1xyXG4gICAgICAgIHRoaXMuY3VycmVudElkeCA9IGluZGV4O1xyXG4gICAgfVxyXG4gICAgc3dpdGNoU2NlbmVzKGluZGV4KSB7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50SWR4ID0gaW5kZXg7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q3VycmVudFNjZW5lKCk7XHJcbiAgICB9XHJcbiAgICBnZXRDdXJyZW50U2NlbmUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc2NlbmVzW3RoaXMuY3VycmVudElkeF07XHJcbiAgICB9XHJcbiAgICBnZXRDdXJyZW50RW50aXRpZXMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc2NlbmVzW3RoaXMuY3VycmVudElkeF0uZW50aXRpZXM7XHJcbiAgICB9XHJcbiAgICBhZGRDdXJyZW50RW50aXR5KGVudGl0eSkge1xyXG4gICAgfVxyXG4gICAgc3RhdGljIGdldFVuaXF1ZUlkKCkge1xyXG4gICAgICAgIHJldHVybiBTY2VuZU1hbmFnZXIuaWQrKztcclxuICAgIH1cclxuICAgIHN0YXRpYyBnZXRVbmlxdWVDb21wb25lbnRJZCgpIHtcclxuICAgICAgICByZXR1cm4gU2NlbmVNYW5hZ2VyLmNvbXBvbmVudElkKys7XHJcbiAgICB9XHJcbn1cclxuU2NlbmVNYW5hZ2VyLmlkID0gMDtcclxuU2NlbmVNYW5hZ2VyLmNvbXBvbmVudElkID0gMDtcclxuY2xhc3MgRGVmYXVsdFNjZW5lIGV4dGVuZHMgU2NlbmUge1xyXG59XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVNjZW5lTWFuYWdlci5qcy5tYXAiLCJpbXBvcnQgeyBFdmVudEhhbmRsZXIgfSBmcm9tIFwiLi4vZXZlbnRzL0V2ZW50SGFuZGxlci5qc1wiO1xyXG5pbXBvcnQgeyBHcmFwaGljc0VuZ2luZSB9IGZyb20gXCIuLi9ncmFwaGljcy9HcmFwaGljRW5naW5lLmpzXCI7XHJcbmltcG9ydCB7IFBoeXNpY3NFbmdpbmUgfSBmcm9tIFwiLi4vcGh5c2ljcy9QaHlzaWNzRW5naW5lLmpzXCI7XHJcbmltcG9ydCB7IEVuZ2luZUNvbmZpZyB9IGZyb20gXCIuLi90eXBlcy9jb25maWcuanNcIjtcclxuaW1wb3J0IHsgU2NlbmVNYW5hZ2VyIH0gZnJvbSBcIi4vbWFuYWdlcnMvU2NlbmVNYW5hZ2VyLmpzXCI7XHJcbmV4cG9ydCBjbGFzcyBFbmdpbmUge1xyXG4gICAgY29uc3RydWN0b3IoZ2FtZUNvbmZpZyA9IG5ldyBFbmdpbmVDb25maWcoKSwgc3lzdGVtcykge1xyXG4gICAgICAgIHRoaXMuY2FudmFzSUQgPSBcImVuZ2luZUNhbnZhc1wiO1xyXG4gICAgICAgIHRoaXMuc3lzdGVtcyA9IFtdO1xyXG4gICAgICAgIHRoaXMudGltZSA9IDA7XHJcbiAgICAgICAgdGhpcy5lbmdpbmVDb25maWcgPSBnYW1lQ29uZmlnO1xyXG4gICAgICAgIGlmICh0aGlzLmVuZ2luZUNvbmZpZy5ldmVudENvbmZpZykge1xyXG4gICAgICAgICAgICB0aGlzLnN5c3RlbXMucHVzaChuZXcgRXZlbnRIYW5kbGVyKHRoaXMuZW5naW5lQ29uZmlnLmV2ZW50Q29uZmlnKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmVuZ2luZUNvbmZpZy5waHlzaWNzQ29uZmlnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3lzdGVtcy5wdXNoKG5ldyBQaHlzaWNzRW5naW5lKCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoc3lzdGVtcykge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBzeXMgb2Ygc3lzdGVtcykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zeXN0ZW1zLnB1c2goc3lzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5lbmdpbmVDb25maWcuZ3JhcGhpY3NDb25maWcpIHtcclxuICAgICAgICAgICAgdGhpcy5ncmFwaGljcyA9IG5ldyBHcmFwaGljc0VuZ2luZSh0aGlzLmVuZ2luZUNvbmZpZy5ncmFwaGljc0NvbmZpZyk7XHJcbiAgICAgICAgICAgIHRoaXMuc3lzdGVtcy5wdXNoKHRoaXMuZ3JhcGhpY3MpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNjZW5lTWFuYWdlciA9IG5ldyBTY2VuZU1hbmFnZXIodGhpcy5lbmdpbmVDb25maWcuc2NlbmVDb25maWcsIHRoaXMuc3lzdGVtcyk7XHJcbiAgICAgICAgdGhpcy5ydW5uaW5nID0gdHJ1ZTtcclxuICAgICAgICBmb3IgKHZhciBzeXMgb2YgdGhpcy5zeXN0ZW1zKSB7XHJcbiAgICAgICAgICAgIHZhciBjb21wID0gdGhpcy5zY2VuZU1hbmFnZXIuZ2V0Q3VycmVudFNjZW5lKCkuZW5naW5lQ29tcG9uZW50cy5nZXQoc3lzLnRhZyk7XHJcbiAgICAgICAgICAgIGlmIChjb21wKSB7XHJcbiAgICAgICAgICAgICAgICBzeXMuY29tcG9uZW50cyA9IGNvbXA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcihcImVycm9yIGluIHN0YXJ0IG1ldGhvZFwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnJ1bm5pbmcgPSBmYWxzZTtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKlxyXG4gICAgICAgICBcclxuICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gJzEwMCUnXHJcbiAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLndpZHRoID0gJzEwMCUnXHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5oZWlnaHQgPSBcIjEwMCVcIlxyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUud2lkdGggPSBcIjEwMCVcIlxyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUubWFyZ2luID0gXCIwXCJcclxuICAgICAgICB0aGlzLnNldHVwKClcclxuICAgICAgICB0aGlzLmRpdiA9IHRoaXMuZ2VuZXJhdGVEaXYodGhpcy5lbmdpbmVDb25maWcucGFyZW50KSA7XHJcbiAgICAgICAgdGhpcy5ydW5uaW5nID0gZmFsc2VcclxuICAgICAgICAqL1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICBwYXJzZVN0eWxlKHN0eWxlT2JqZWN0OiBPYmplY3QpOiAgc3RyaW5nIHtcclxuICAgICAgICB2YXIgY3NzQXJyYXk6IHN0cmluZ1tdID0gT2JqZWN0LmVudHJpZXMoc3R5bGVPYmplY3QpLm1hcCgoW2ssdl0pID0+IGsgKyBcIjpcIiArIHYgKyBcIjtcIilcclxuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmVuZ2luZUNvbmZpZy5wYXJlbnQpXHJcbiAgICAgICAgcmV0dXJuIGNzc0FycmF5LmpvaW4oXCIgXCIpXHJcbiAgICB9XHJcbiAgICAqL1xyXG4gICAgLyoqXHJcbiAgICBnZW5lcmF0ZURpdihwYXJlbnQ6IHN0cmluZykge1xyXG4gICAgICAgIHZhciBkaXY6IEhUTUxEaXZFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcclxuICAgICAgICBkaXYuaWQgPSBwYXJlbnRcclxuICAgICAgICBkaXYuc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCJcclxuICAgICAgICBkaXYuc3R5bGUuaGVpZ2h0ID0gXCIxMDAlXCJcclxuICAgICAgICBkaXYuc3R5bGUud2lkdGggPSBcIjEwMCVcIlxyXG4gICAgICAgIGRpdi5zdHlsZS56SW5kZXggPSBcIjFcIlxyXG4gICAgICAgIGRpdi5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcIi9pbWFnZXMvdGVzdC5qcGdcIlxyXG4gICAgICAgIGRpdi5hcHBlbmRDaGlsZCh0aGlzLmdlbmVyYXRlQ2FudmFzKCkpXHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChkaXYpXHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKFwidGVzdFwiKVxyXG4gICAgICAgIHJldHVybiBkaXZcclxuICAgIH1cclxuICAgIGdlbmVyYXRlQ2FudmFzKCk6IEhUTUxFbGVtZW50IHtcclxuICAgICAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIkNBTlZBU1wiKVxyXG4gICAgICAgIGNhbnZhcy5pZCA9IHRoaXMuY2FudmFzSURcclxuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLnBhcnNlU3R5bGUodGhpcy5lbmdpbmVDb25maWcuc3R5bGUpKVxyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiQmVmb3JlXCIpXHJcbiAgICAgICAgY2FudmFzLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCB0aGlzLnBhcnNlU3R5bGUodGhpcy5lbmdpbmVDb25maWcuc3R5bGUpKVxyXG4gICAgICAgIHJldHVybiBjYW52YXNcclxuICAgIH1cclxuICAgIGdldEN0eCgpIHtcclxuICAgICAgICB2YXIgY2FudmFzID0gdGhpcy5nZXRDYW52YXMoKVxyXG4gICAgICAgIHJldHVybiBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpXHJcbiAgICB9XHJcbiAgICBnZXRDYW52YXMoKTogSFRNTENhbnZhc0VsZW1lbnQge1xyXG4gICAgICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLmNhbnZhc0lEKVxyXG4gICAgICAgIGlmIChjYW52YXMgaW5zdGFuY2VvZiBIVE1MQ2FudmFzRWxlbWVudCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY2FudmFzXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoXCJlbmdpbmVDYW52YXMgc2hvdWxkIGJlIGEgcmVzZXJ2ZWQgaWQgZm9yIERPTSBDb21wb25lbnRzXCIpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgfVxyXG4gICAgXHJcbiAgICAgKlxyXG4gICAgIFxyXG4gICAgc2V0dXAoKSB7XHJcbiAgICAgICAgdmFyIGNvbmZpZyA9IHRoaXMuZW5naW5lQ29uZmlnXHJcbiAgICAgICAgaWYgKHRydWUpIHtcclxuICAgICAgICAgICAgdmFyIGltYWdlID0gbmV3IEltYWdlKClcclxuICAgICAgICAgICAgaW1hZ2Uuc3JjID0gXCIvaW1hZ2VzL3Rlc3QuanBnXCJcclxuICAgICAgICAgICAgaW1hZ2Uuc3R5bGUucG9zaXRpb24gPVwiYWJzb2x1dGVcIlxyXG4gICAgICAgICAgICBpbWFnZS5zdHlsZS56SW5kZXggPSBcIi0xXCJcclxuICAgICAgICAgICAgaW1hZ2Uuc3R5bGUud2lkdGggPSBcIjEwMCVcIlxyXG4gICAgICAgICAgICBpbWFnZS5zdHlsZS5oZWlnaHQ9IFwiMTAwJVwiXHJcblxyXG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGltYWdlKVxyXG5cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAqL1xyXG4gICAgc3RhcnQoZHQpIHtcclxuICAgICAgICB0aGlzLnJ1bm5pbmcgPSB0cnVlO1xyXG4gICAgICAgIGlmICh0aGlzLmdyYXBoaWNzKSB7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlKGR0KTtcclxuICAgICAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLnN0YXJ0KGR0KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB3aGlsZSAodGhpcy5ydW5uaW5nKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZShkdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICB1cGRhdGUoZHQpIHtcclxuICAgICAgICBmb3IgKHZhciBzeXMgb2YgdGhpcy5zeXN0ZW1zKSB7XHJcbiAgICAgICAgICAgIHN5cy51cGRhdGUoZHQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnRpbWUgKz0gZHQ7XHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcy50aW1lKTtcclxuICAgIH1cclxufVxyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1lbmdpbmUuanMubWFwIiwiZXhwb3J0IGNsYXNzIFRyYW5zZm9ybSB7XHJcbiAgICBjb25zdHJ1Y3RvcihlbnRpdHksIHBvcyA9IHsgeDogMCwgeTogMCwgejogMCB9LCB2ZWwgPSB7IHg6IDAsIHk6IDAsIHo6IDAgfSwgYWNjZWwgPSB7IHg6IDAsIHk6IDAsIHo6IDAgfSkge1xyXG4gICAgICAgIHRoaXMuZW5naW5lVGFnID0gXCJQSFlTSUNTXCI7XHJcbiAgICAgICAgdGhpcy5lbnRpdHkgPSBlbnRpdHk7XHJcbiAgICAgICAgdGhpcy5wb3MgPSBwb3M7XHJcbiAgICAgICAgdGhpcy52ZWwgPSB2ZWw7XHJcbiAgICAgICAgdGhpcy5hY2NlbCA9IGFjY2VsO1xyXG4gICAgfVxyXG4gICAgdXBkYXRlKGR0KSB7XHJcbiAgICAgICAgdGhpcy52ZWwueCA9IHRoaXMudmVsLnggKyB0aGlzLmFjY2VsLnggKiBkdDtcclxuICAgICAgICB0aGlzLnZlbC55ID0gdGhpcy52ZWwueSArIHRoaXMuYWNjZWwueSAqIGR0O1xyXG4gICAgICAgIHRoaXMudmVsLnogPSB0aGlzLnZlbC56ICsgdGhpcy5hY2NlbC56ICogZHQ7XHJcbiAgICAgICAgdGhpcy5wb3MueCA9IHRoaXMucG9zLnggKyB0aGlzLnZlbC54ICogZHQ7XHJcbiAgICAgICAgdGhpcy5wb3MueSA9IHRoaXMucG9zLnkgKyB0aGlzLnZlbC55ICogZHQ7XHJcbiAgICAgICAgdGhpcy5wb3MueiA9IHRoaXMucG9zLnogKyB0aGlzLnZlbC56ICogZHQ7XHJcbiAgICB9XHJcbn1cclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dHJhbnNmb3JtLmpzLm1hcCIsImV4cG9ydCBjbGFzcyBSZWN0YW5nbGUge1xyXG4gICAgY29uc3RydWN0b3IoZW50aXR5LCB0cmFuc2Zvcm0pIHtcclxuICAgICAgICB0aGlzLmVuZ2luZVRhZyA9IFwiR1JBUEhJQ1NcIjtcclxuICAgICAgICB0aGlzLmVudGl0eSA9IGVudGl0eTtcclxuICAgICAgICB0aGlzLnRyYW5zZm9ybSA9IHRyYW5zZm9ybTtcclxuICAgIH1cclxuICAgIHVwZGF0ZShkdCwgY3R4KSB7XHJcbiAgICAgICAgaWYgKGN0eCkge1xyXG4gICAgICAgICAgICB2YXIgciA9IE1hdGgucmFuZG9tKCkgKiAyNTU7XHJcbiAgICAgICAgICAgIHZhciBnID0gTWF0aC5yYW5kb20oKSAqIDI1NTtcclxuICAgICAgICAgICAgdmFyIGIgPSBNYXRoLnJhbmRvbSgpICogMjU1O1xyXG4gICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gYHJnYihcclxuICAgICAgICAgICAgICAgICR7cn0sXHJcbiAgICAgICAgICAgICAgICAke2d9LFxyXG4gICAgICAgICAgICAgICAgJHtifSlgO1xyXG4gICAgICAgICAgICBjdHguZmlsbFJlY3QodGhpcy50cmFuc2Zvcm0ucG9zLngsIHRoaXMudHJhbnNmb3JtLnBvcy55LCAyMCwgMjApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1SZWN0YW5nbGUuanMubWFwIiwiZXhwb3J0IGNsYXNzIE1vdXNlTGlzdGVuZXIge1xyXG4gICAgY29uc3RydWN0b3IoZW50aXR5LCBjbGlja01hcCkge1xyXG4gICAgICAgIHRoaXMuZW5naW5lVGFnID0gXCJFVkVOVEhBTkRMRVJcIjtcclxuICAgICAgICB0aGlzLmVudGl0eSA9IGVudGl0eTtcclxuICAgICAgICB0aGlzLmV2ZW50TWFwID0gbmV3IE1hcCgpO1xyXG4gICAgICAgIE9iamVjdC5lbnRyaWVzKGNsaWNrTWFwKS5tYXAoKFtrLCB2XSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmV2ZW50TWFwLnNldChrLCB2KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIHVwZGF0ZShkdCwgY3R4KSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJJbiBtb3VzZSBMaXN0ZW5lclwiKTtcclxuICAgIH1cclxufVxyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1MaXN0ZW5lci5qcy5tYXAiLCJpbXBvcnQgeyBUcmFuc2Zvcm0gfSBmcm9tIFwiLi4vLi4vLi4vZW5naW5lL3NyYy9jb21wb25lbnRzL1BoeXNpY3MvdHJhbnNmb3JtLmpzXCI7XHJcbmltcG9ydCB7IFJlY3RhbmdsZSB9IGZyb20gXCIuLi8uLi8uLi9lbmdpbmUvc3JjL2NvbXBvbmVudHMvR3JhcGhpY3MvUmVjdGFuZ2xlLmpzXCI7XHJcbmltcG9ydCB7IE1vdXNlTGlzdGVuZXIgfSBmcm9tIFwiLi4vLi4vLi4vZW5naW5lL3NyYy9jb21wb25lbnRzL0V2ZW50L0xpc3RlbmVyLmpzXCI7XHJcbmV4cG9ydCBjbGFzcyBQbGF5ZXIge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy50cmFuc2Zvcm0gPSBuZXcgVHJhbnNmb3JtKHRoaXMsIHtcclxuICAgICAgICAgICAgeDogMjAsXHJcbiAgICAgICAgICAgIHk6IDIwLFxyXG4gICAgICAgICAgICB6OiAyMFxyXG4gICAgICAgIH0sIHtcclxuICAgICAgICAgICAgeDogMSxcclxuICAgICAgICAgICAgeTogMSxcclxuICAgICAgICAgICAgejogMFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHZhciBmdW5jID0gKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnRyYW5zZm9ybS5wb3MueCA9IDA7XHJcbiAgICAgICAgICAgIHRoaXMudHJhbnNmb3JtLnBvcy55ID0gMDtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMucmVuZGVyZXIgPSBuZXcgUmVjdGFuZ2xlKHRoaXMsIHRoaXMudHJhbnNmb3JtKTtcclxuICAgICAgICB0aGlzLmxpc3RlbmVyID0gbmV3IE1vdXNlTGlzdGVuZXIodGhpcywge1xyXG4gICAgICAgICAgICBcImNsaWNrXCI6IGZ1bmMsXHJcbiAgICAgICAgICAgIFwidGVzdDJcIjogKCkgPT4geyBjb25zb2xlLmxvZyhcInRlc3QyXCIpOyB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5jb21wb25lbnRzID0gW1xyXG4gICAgICAgICAgICB0aGlzLnRyYW5zZm9ybSxcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJlcixcclxuICAgICAgICAgICAgdGhpcy5saXN0ZW5lclxyXG4gICAgICAgIF07XHJcbiAgICB9XHJcbn1cclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9UGxheWVyLmpzLm1hcCIsImltcG9ydCB7IEVuZ2luZSB9IGZyb20gXCIuLi9lbmdpbmUvc3JjL2NvcmUvZW5naW5lLmpzXCI7XHJcbmltcG9ydCB7IEdyYXBoaWNzQ29uZmlnIH0gZnJvbSBcIi4uL2VuZ2luZS9zcmMvdHlwZXMvY29uZmlnLmpzXCI7XHJcbmltcG9ydCB7IFBsYXllciB9IGZyb20gXCIuL3NjZW5lcy9lbnRpdGllcy9QbGF5ZXIuanNcIjtcclxud2luZG93Lm9ubG9hZCA9ICgpID0+IHtcclxuICAgIC8qKlxyXG4gICAgICpcclxuICAgICBcclxuICAgIHZhciBzb2NrZXQ6IFNvY2tldCA9IGlvKClcclxuXHJcbiAgICBsZXQgQ09ORklHOiBQaGFzZXIuVHlwZXMuQ29yZS5HYW1lQ29uZmlnID0ge1xyXG4gICAgICAgIHR5cGU6IFBoYXNlci5BVVRPLFxyXG4gICAgICAgIHRpdGxlOiAndGVzdCcsXHJcbiAgICAgICAgcGFyZW50OiAnZ2FtZScsXHJcbiAgICAgICAgc2NlbmU6IFtcclxuICAgICAgICAgICAgbmV3IFdhaXRpbmdTY2VuZShzb2NrZXQpXHJcbiAgICAgICAgXSxcclxuICAgICAgICBzY2FsZToge1xyXG4gICAgICAgICAgICBtb2RlOiBQaGFzZXIuU2NhbGUuQ0VOVEVSX0JPVEgsXHJcbiAgICAgICAgICAgIHdpZHRoOiB3aW5kb3cuc2NyZWVuLmF2YWlsV2lkdGggLSAod2luZG93Lm91dGVyV2lkdGggLSB3aW5kb3cuaW5uZXJXaWR0aCksXHJcbiAgICAgICAgICAgIGhlaWdodDogd2luZG93LnNjcmVlbi5hdmFpbEhlaWdodCAtICh3aW5kb3cub3V0ZXJIZWlnaHQgLSB3aW5kb3cuaW5uZXJIZWlnaHQpXHJcbiAgICAgICAgfSxcclxuICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IFwiIzNhYmEzYVwiLFxyXG4gICAgICAgIHVybDogd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lLFxyXG5cclxuICAgICAgICBkb206IHtcclxuICAgICAgICAgICAgY3JlYXRlQ29udGFpbmVyOiB0cnVlXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgICAgIHNvY2tldC5vbihcImNvbm5lY3RcIiwgKCk9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdDb25uZWN0ZWQnKVxyXG4gICAgICAgICAgICB2YXIgcm9vbUlkOiBzdHJpbmcgPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWVcclxuICAgICAgICAgICAgdmFyIHJvb21BcnI6IHN0cmluZ1tdICA9IHJvb21JZC5zcGxpdChcIi9cIilcclxuICAgICAgICAgICAgY29uc29sZS5sb2cocm9vbUFycltyb29tQXJyLmxlbmd0aC0xXSlcclxuICAgICAgICAgICAgY29uc29sZS5sb2cocm9vbUlkKVxyXG4gICAgICAgICAgICBzb2NrZXQuZW1pdChcIkFkZFBsYXllclwiLCB3aW5kb3cuc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcIlBsYXllck5hbWVcIiksIHJvb21BcnJbcm9vbUFyci5sZW5ndGgtMV0pXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgc29ja2V0Lm9uKFwiZGlzY29ubmVjdFwiLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdkaXNjb25uZWN0ZWQnKVxyXG4gICAgICAgIH0pXHJcbiAgICB2YXIgZ2FtZTogUGhhc2VyLkdhbWUgPSBuZXcgUGhhc2VyLkdhbWUoQ09ORklHKVxyXG4gICAgKi9cclxuICAgIGxldCBlbmdpbmUgPSBuZXcgRW5naW5lKHtcclxuICAgICAgICBwaHlzaWNzQ29uZmlnOiB7fSxcclxuICAgICAgICBncmFwaGljc0NvbmZpZzogbmV3IEdyYXBoaWNzQ29uZmlnKFwidGVzdFwiLCBcIjE5M2FzXCIsIHsgXCJiYWNrZ3JvdW5kLWNvbG9yXCI6IFwid2hpdGVcIiwgXCJ3aWR0aFwiOiBcIjEwMCVcIiwgXCJoZWlnaHRcIjogXCIxMDAlXCIgfSksXHJcbiAgICAgICAgc2NlbmVDb25maWc6IFtcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgbmFtZTogXCJhc1wiLFxyXG4gICAgICAgICAgICAgICAgZW50aXRpZXM6IFtcclxuICAgICAgICAgICAgICAgICAgICBuZXcgUGxheWVyKClcclxuICAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIF0sXHJcbiAgICAgICAgZXZlbnRDb25maWc6IHtcclxuICAgICAgICAgICAga2V5Ym9hcmQ6IHRydWUsXHJcbiAgICAgICAgICAgIG1vdXNlOiB0cnVlXHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBlbmdpbmUuc3RhcnQoMSk7XHJcbn07XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCJdLCJuYW1lcyI6WyJFdmVudEhhbmRsZXIiLCJjb25zdHJ1Y3RvciIsImV2ZW50Q29uZmlnIiwia2V5Ym9hcmQiLCJtb3VzZSIsInRoaXMiLCJ0YWciLCJjb21wb25lbnRzIiwiZXZlbnRzIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwicHVzaCIsImNvbnNvbGUiLCJsb2ciLCJrZXkiLCJ1cGRhdGUiLCJkdCIsImNvbXAiLCJldmVudE1hcCIsImUiLCJmdW5jIiwiZ2V0IiwiR3JhcGhpY3NFbmdpbmUiLCJncmFwaGljc0NvbmZpZyIsImRvY3VtZW50IiwiZG9jdW1lbnRFbGVtZW50Iiwic3R5bGUiLCJoZWlnaHQiLCJ3aWR0aCIsImJvZHkiLCJtYXJnaW4iLCJzZXR1cCIsImNhbnZhcyIsImdlbmVyYXRlQ2FudmFzIiwiY3R4IiwiZ2V0Q29udGV4dCIsImRpdiIsImdlbmVyYXRlRGl2IiwicGFyZW50IiwiZW50aXRpZXMiLCJjbGVhclJlY3QiLCJjb21wb25lbnRJZCIsImNyZWF0ZUVsZW1lbnQiLCJpZCIsInBvc2l0aW9uIiwiekluZGV4IiwiYmFja2dyb3VuZEltYWdlIiwiYXBwZW5kQ2hpbGQiLCJjYW52YXNJRCIsInBhcnNlU3R5bGUiLCJzZXRBdHRyaWJ1dGUiLCJnZXRDdHgiLCJnZXRDYW52YXMiLCJnZXRFbGVtZW50QnlJZCIsIkhUTUxDYW52YXNFbGVtZW50IiwiRXJyb3IiLCJzdHlsZU9iamVjdCIsImNzc0FycmF5IiwiT2JqZWN0IiwiZW50cmllcyIsIm1hcCIsImsiLCJ2Iiwiam9pbiIsImltYWdlIiwiSW1hZ2UiLCJzcmMiLCJQaHlzaWNzRW5naW5lIiwiR3JhcGhpY3NDb25maWciLCJiYWNrZ3JvdW5kIiwiRW5naW5lQ29uZmlnIiwiU2NlbmVDb25maWciLCJuYW1lIiwic2NlbmVDb25maWciLCJzeXN0ZW1zIiwic3lzdGVtIiwiTWFwIiwiZW5naW5lQ29tcG9uZW50cyIsInNldCIsImFkZEVudGl0eSIsInRpbWUiLCJlbnRpdHkiLCJ1bmlxdWVJZCIsIlNjZW5lTWFuYWdlciIsImdldFVuaXF1ZUlkIiwic2NlbmUiLCJjb21wTGlzdCIsImVuZ2luZVRhZyIsImtleXMiLCJjcmVhdGVDb21wb25lbnQiLCJyZW1vdmVFbnRpdHkiLCJnZXRFbnRpdHkiLCJlbmdpbmVDb21wTGlzdCIsImkiLCJsZW5ndGgiLCJzcGxpY2UiLCJnZXRVbmlxdWVDb21wb25lbnRJZCIsImNvbmZpZyIsImluZGV4Iiwic2NlbmVDb25maWdzIiwic2NlbmVzIiwiY3VyckNvbmZpZyIsImN1cnJlbnRJZHgiLCJzd2l0Y2hTY2VuZXMiLCJnZXRDdXJyZW50U2NlbmUiLCJnZXRDdXJyZW50RW50aXRpZXMiLCJhZGRDdXJyZW50RW50aXR5Iiwic3RhdGljIiwiRW5naW5lIiwiZ2FtZUNvbmZpZyIsImVuZ2luZUNvbmZpZyIsInBoeXNpY3NDb25maWciLCJzeXMiLCJncmFwaGljcyIsInNjZW5lTWFuYWdlciIsInJ1bm5pbmciLCJzdGFydCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsIlRyYW5zZm9ybSIsInBvcyIsIngiLCJ5IiwieiIsInZlbCIsImFjY2VsIiwiUmVjdGFuZ2xlIiwidHJhbnNmb3JtIiwiciIsIk1hdGgiLCJyYW5kb20iLCJnIiwiYiIsImZpbGxTdHlsZSIsImZpbGxSZWN0IiwiTW91c2VMaXN0ZW5lciIsImNsaWNrTWFwIiwiUGxheWVyIiwicmVuZGVyZXIiLCJsaXN0ZW5lciIsIm9ubG9hZCJdLCJzb3VyY2VSb290IjoiIn0=